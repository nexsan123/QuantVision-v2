# Sprint 5: å› å­éªŒè¯ + å½’å›  + å†²çªæ£€æµ‹ (5å¤©)

> **æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
> **é¢„è®¡æ—¶é•¿**: 5å¤©  
> **å‰ç½®ä¾èµ–**: Sprint 4 å®Œæˆ  
> **PRDå‚è€ƒ**: 4.3 å› å­æœ‰æ•ˆæ€§éªŒè¯, 4.5 äº¤æ˜“å½’å› ç³»ç»Ÿ, 4.6 ç­–ç•¥å†²çªæ£€æµ‹  
> **äº¤ä»˜ç‰©**: å› å­éªŒè¯é¢æ¿ã€äº¤æ˜“å½’å› ç³»ç»Ÿã€å†²çªæ£€æµ‹å¼¹çª—

---

## ç›®æ ‡

å®ç°PRDä¸­P0ä¼˜å…ˆçº§çš„æ ¸å¿ƒåŠŸèƒ½ï¼šå› å­æœ‰æ•ˆæ€§éªŒè¯ã€äº¤æ˜“å½’å› ç³»ç»Ÿã€ç­–ç•¥å†²çªæ£€æµ‹

---

## Part A: å› å­æœ‰æ•ˆæ€§éªŒè¯ç³»ç»Ÿ (2å¤©)

### Task 5.1: å› å­éªŒè¯Schema (åç«¯)

**æ–‡ä»¶**: `backend/app/schemas/factor_validation.py`

**æ ¸å¿ƒæ¨¡å‹**:
```python
class EffectivenessLevel(str, Enum):
    STRONG = "strong"      # IC_IR > 0.5, å¤šç©ºæ”¶ç›Šå·® > 10%
    MEDIUM = "medium"      # IC_IR > 0.3, å¤šç©ºæ”¶ç›Šå·® > 5%
    WEAK = "weak"          # IC_IR > 0.1, å¤šç©ºæ”¶ç›Šå·® > 2%
    INEFFECTIVE = "ineffective"

class FactorValidationResult(BaseModel):
    factor_id: str
    factor_name: str
    plain_description: str      # å¤§ç™½è¯æè¿°
    investment_logic: str       # æŠ•èµ„é€»è¾‘
    ic_stats: ICStatistics      # IC/IRç»Ÿè®¡
    return_stats: ReturnStatistics  # æ”¶ç›Šç»Ÿè®¡
    is_effective: bool
    effectiveness_level: EffectivenessLevel
    suggested_combinations: list[str]  # å»ºè®®ç»„åˆå› å­
    usage_tips: list[str]       # ä½¿ç”¨å»ºè®®
    risk_warnings: list[str]    # é£é™©æç¤º
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æœ‰æ•ˆæ€§ç­‰çº§åˆ†ç±»åˆç†
- [ ] åŒ…å«å¤§ç™½è¯æè¿°å­—æ®µ
- [ ] åŒ…å«ä½¿ç”¨å»ºè®®å­—æ®µ

---

### Task 5.2: å› å­éªŒè¯æœåŠ¡ (åç«¯)

**æ–‡ä»¶**: `backend/app/services/factor_validation_service.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- IC/IRè®¡ç®—
- åˆ†ç»„æ”¶ç›Šç»Ÿè®¡
- æœ‰æ•ˆæ€§åˆ¤å®š
- å› å­ç»„åˆæ¨è

**æœ‰æ•ˆæ€§åˆ¤å®šé€»è¾‘**:
```python
EFFECTIVENESS_THRESHOLDS = {
    "strong": {"ic_ir": 0.5, "spread": 0.10},
    "medium": {"ic_ir": 0.3, "spread": 0.05},
    "weak": {"ic_ir": 0.1, "spread": 0.02},
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] IC/IRè®¡ç®—æ­£ç¡®
- [ ] æœ‰æ•ˆæ€§åˆ¤å®šåˆç†
- [ ] å¤§ç™½è¯æè¿°æ¸…æ™°

---

### Task 5.3: å› å­éªŒè¯API (åç«¯)

**æ–‡ä»¶**: `backend/app/api/v1/factor_validation.py`

**ç«¯ç‚¹**:
```
GET  /api/v1/factors/{id}/validation  - è·å–éªŒè¯ç»“æœ
POST /api/v1/factors/{id}/validate    - è§¦å‘éªŒè¯
POST /api/v1/factors/compare          - å› å­å¯¹æ¯”
GET  /api/v1/factors/{id}/suggestions - ç»„åˆå»ºè®®
```

---

### Task 5.4: å› å­éªŒè¯å‰ç«¯ç»„ä»¶

**æ–‡ä»¶**: `frontend/src/components/Factor/FactorValidation.tsx`

**UIè®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”¬ PE_TTM å› å­éªŒè¯               [æœ‰æ•ˆæ€§: ä¸­ â­â­â­] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“– é€šä¿—è§£é‡Š                                         â”‚
â”‚ PEè¶Šä½ï¼Œè¯´æ˜è‚¡ä»·ç›¸å¯¹äºå…¬å¸ç›ˆåˆ©è¶Šä¾¿å®œã€‚              â”‚
â”‚ ä¹°å…¥ä½PEè‚¡ç¥¨ï¼Œé•¿æœŸèƒ½è·å¾—è¶…é¢æ”¶ç›Šã€‚                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ICå‡å€¼: 4.5%  â”‚ IC_IR: 0.56  â”‚ å¤šç©ºæ”¶ç›Šå·®: 6.2%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ˆ ICæ—¶åºå›¾                                         â”‚
â”‚ [å›¾è¡¨...]                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š åˆ†ç»„æ”¶ç›Š                                         â”‚
â”‚ ç¬¬1ç»„: 14.3% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                          â”‚
â”‚ ç¬¬2ç»„: 11.8% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                             â”‚
â”‚ ç¬¬3ç»„:  9.5% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ ä½¿ç”¨å»ºè®®                                         â”‚
â”‚ - è¯¥å› å­è¡¨ç°ä¸­ç­‰ï¼Œå»ºè®®ä¸å…¶ä»–å› å­ç»„åˆä½¿ç”¨            â”‚
â”‚ - æ¨èæ­é…: ROE, DIVIDEND_YIELD                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           [å¯¹æ¯”å…¶ä»–å› å­] [æ·»åŠ åˆ°ç­–ç•¥]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] éªŒè¯ç»“æœæ­£ç¡®æ˜¾ç¤º
- [ ] ICå›¾è¡¨æ¸²æŸ“æ­£å¸¸
- [ ] ä½¿ç”¨å»ºè®®æœ‰ä»·å€¼

---

## Part B: äº¤æ˜“å½’å› ç³»ç»Ÿ (2å¤©)

### Task 5.5: äº¤æ˜“è®°å½•å’Œå½’å› Schema (åç«¯)

**æ–‡ä»¶**: 
- `backend/app/schemas/trade_record.py`
- `backend/app/schemas/attribution_report.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- æ¯ç¬”äº¤æ˜“è‡ªåŠ¨è®°å½•
- å…¥åœºæ—¶å› å­å€¼å¿«ç…§
- å…¥åœºæ—¶å¸‚åœºç¯å¢ƒå¿«ç…§
- è‡ªåŠ¨è§¦å‘å½’å› åˆ†æ

**è‡ªåŠ¨è§¦å‘æ¡ä»¶**:
| ç­–ç•¥ç±»å‹ | è§¦å‘æ¡ä»¶ | å¼‚å¸¸è§¦å‘ |
|----------|----------|----------|
| æ—¥å†…äº¤æ˜“ | æ¯æ—¥æˆ–æ¯50ç¬” | å•æ—¥äºæŸ>2% |
| çŸ­çº¿ | æ¯å‘¨æˆ–æ¯20ç¬” | è¿ç»­3ç¬”äºæŸ |
| ä¸­çº¿ | æ¯æœˆæˆ–æ¯10ç¬” | ç´¯è®¡å›æ’¤>5% |
| é•¿çº¿ | æ¯å­£åº¦æˆ–æ¯5ç¬” | å•ç¬”äºæŸ>3% |

---

### Task 5.6: å½’å› æœåŠ¡ (åç«¯)

**æ–‡ä»¶**: `backend/app/services/attribution_service.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- äº¤æ˜“è®°å½•ç®¡ç†
- å½’å› æŠ¥å‘Šç”Ÿæˆ
- AIè¯Šæ–­ç”Ÿæˆ
- æ¨¡å¼è¯†åˆ«

**AIè¯Šæ–­å†…å®¹**:
```python
class AIDiagnosis(BaseModel):
    summary: str          # è¯Šæ–­æ‘˜è¦
    strengths: list[str]  # ä¼˜åŠ¿
    weaknesses: list[str] # åŠ£åŠ¿
    suggestions: list[str] # æ”¹è¿›å»ºè®®
    risk_alerts: list[str] # é£é™©æç¤º
```

---

### Task 5.7: å½’å› APIå’Œå‰ç«¯

**APIç«¯ç‚¹**:
```
GET  /api/v1/trades                   - äº¤æ˜“è®°å½•åˆ—è¡¨
GET  /api/v1/attribution/reports      - å½’å› æŠ¥å‘Šåˆ—è¡¨
POST /api/v1/attribution/generate     - æ‰‹åŠ¨è§¦å‘å½’å› 
GET  /api/v1/attribution/diagnosis/{id} - AIè¯Šæ–­
```

**å‰ç«¯ç»„ä»¶**:
- `components/Attribution/ReportPanel.tsx` - å½’å› æŠ¥å‘Šé¢æ¿
- `components/Attribution/AIDiagnosis.tsx` - AIè¯Šæ–­å¡ç‰‡

---

## Part C: ç­–ç•¥å†²çªæ£€æµ‹ç³»ç»Ÿ (1å¤©)

### Task 5.8: å†²çªæ£€æµ‹Schema (åç«¯)

**æ–‡ä»¶**: `backend/app/schemas/conflict.py`

**å†²çªç±»å‹**:
```python
class ConflictType(str, Enum):
    NO_CONFLICT = "no_conflict"        # æ— å†²çª
    LOGIC_CONFLICT = "logic_conflict"  # é€»è¾‘å†²çª: åŒç±»ç­–ç•¥ç›¸åä¿¡å·
    EXECUTION_CONFLICT = "execution_conflict"  # æ‰§è¡Œå†²çª: ä¸åŒç±»å‹ç­–ç•¥
```

**è¶…æ—¶è®¾ç½®**:
| ç­–ç•¥ç±»å‹ | è¶…æ—¶æ—¶é—´ | è¶…æ—¶å¤„ç† |
|----------|:--------:|----------|
| æ—¥å†…äº¤æ˜“ | 1åˆ†é’Ÿ | è‡ªåŠ¨å–æ¶ˆ |
| çŸ­çº¿ç­–ç•¥ | 30åˆ†é’Ÿ | è‡ªåŠ¨å–æ¶ˆ |
| ä¸­é•¿çº¿ | 2å°æ—¶ | è‡ªåŠ¨å–æ¶ˆ |

---

### Task 5.9: å†²çªæœåŠ¡å’ŒAPI (åç«¯)

**æ–‡ä»¶**: 
- `backend/app/services/conflict_service.py`
- `backend/app/api/v1/conflict.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- æ£€æµ‹ä¿¡å·å†²çª
- ç”Ÿæˆå¤„ç†å»ºè®®
- ç®¡ç†è¶…æ—¶

**APIç«¯ç‚¹**:
```
GET  /api/v1/conflicts          - å†²çªåˆ—è¡¨
GET  /api/v1/conflicts/pending  - å¾…å¤„ç†å†²çª
POST /api/v1/conflicts/{id}/resolve - è§£å†³å†²çª
```

---

### Task 5.10: å†²çªå¼¹çª—ç»„ä»¶ (å‰ç«¯)

**æ–‡ä»¶**: `frontend/src/components/Conflict/ConflictModal.tsx`

**UIè®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ ç­–ç•¥å†²çªå¾…å†³ç­–                   [é€»è¾‘å†²çª]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [è¿›åº¦æ¡: å‰©ä½™ 0:45]                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ â”‚ ä¿¡å·A           â”‚  â”‚ ä¿¡å·B           â”‚           â”‚
â”‚ â”‚ AAPL            â”‚  â”‚ AAPL            â”‚           â”‚
â”‚ â”‚ ä»·å€¼ç­–ç•¥        â”‚  â”‚ åŠ¨é‡ç­–ç•¥        â”‚           â”‚
â”‚ â”‚ ğŸ“ˆ ä¹°å…¥         â”‚  â”‚ ğŸ“‰ å–å‡º         â”‚           â”‚
â”‚ â”‚ ä¿¡å·å¼ºåº¦: 85    â”‚  â”‚ ä¿¡å·å¼ºåº¦: 72    â”‚           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ ç³»ç»Ÿå»ºè®®: æ‰§è¡Œä¿¡å·A (ä¿¡å·å¼ºåº¦æ›´é«˜)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â—‹ æ‰§è¡Œä¿¡å·A (ä»·å€¼ç­–ç•¥)                              â”‚
â”‚ â—‹ æ‰§è¡Œä¿¡å·B (åŠ¨é‡ç­–ç•¥)                              â”‚
â”‚ â—‹ å–æ¶ˆä¸¤ä¸ªä¿¡å·ï¼Œè§‚æœ›                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          [ç¨åå†³å®š]  [ç¡®è®¤æ‰§è¡Œ]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] å†²çªå¼¹çª—æ¸…æ™°
- [ ] å€’è®¡æ—¶æ­£ç¡®
- [ ] å†³ç­–é€‰é¡¹å®Œæ•´

---

### Task 5.11: è·¯ç”±æ³¨å†Œ

**ä¿®æ”¹æ–‡ä»¶**: `backend/app/main.py`

```python
from app.api.v1 import factor_validation, attribution, conflict

app.include_router(factor_validation.router, prefix=settings.API_V1_PREFIX)
app.include_router(attribution.router, prefix=settings.API_V1_PREFIX)
app.include_router(conflict.router, prefix=settings.API_V1_PREFIX)
```

---

## Sprint 5 å®Œæˆæ£€æŸ¥æ¸…å•

### å› å­éªŒè¯
- [ ] Schemaå®šä¹‰å®Œæ•´
- [ ] IC/IRè®¡ç®—æ­£ç¡®
- [ ] å¤§ç™½è¯æè¿°æ¸…æ™°
- [ ] å‰ç«¯é¢æ¿æ­£å¸¸

### äº¤æ˜“å½’å› 
- [ ] äº¤æ˜“è®°å½•åŒ…å«å¿«ç…§
- [ ] å½’å› æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆ
- [ ] AIè¯Šæ–­æœ‰ä»·å€¼
- [ ] å‰ç«¯å±•ç¤ºæ­£å¸¸

### å†²çªæ£€æµ‹
- [ ] å†²çªç±»å‹åˆ¤å®šæ­£ç¡®
- [ ] è¶…æ—¶è‡ªåŠ¨å¤„ç†
- [ ] å¼¹çª—å±•ç¤ºæ¸…æ™°
- [ ] å†³ç­–æµç¨‹å®Œæ•´

---

## æ–°å¢APIç«¯ç‚¹

```
# å› å­éªŒè¯
GET  /api/v1/factors/{id}/validation
POST /api/v1/factors/{id}/validate
POST /api/v1/factors/compare
GET  /api/v1/factors/{id}/suggestions

# äº¤æ˜“å½’å› 
GET  /api/v1/trades
GET  /api/v1/trades/{id}
GET  /api/v1/attribution/reports
POST /api/v1/attribution/generate
GET  /api/v1/attribution/diagnosis/{id}

# å†²çªæ£€æµ‹
GET  /api/v1/conflicts
GET  /api/v1/conflicts/pending
POST /api/v1/conflicts/{id}/resolve
```

---

## ä¸‹ä¸€æ­¥

å®Œæˆåè¿›å…¥ **Sprint 6: æˆæœ¬+æ¨¡æ¿+æµ‹è¯•**

---

**é¢„è®¡å®Œæˆæ—¶é—´**: 5å¤©
